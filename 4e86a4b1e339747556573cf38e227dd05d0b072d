{
  "comments": [
    {
      "key": {
        "uuid": "79d89a5c_b54bf81a",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 106,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-10-27T17:57:52Z",
      "side": 1,
      "message": "personally I\u0027m not a fan of hiding such limits when pod is unlimited explicitly",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b26815fa_e5b4c4fe",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 106,
      "author": {
        "id": 23
      },
      "writtenOn": "2020-10-27T18:44:27Z",
      "side": 1,
      "message": "No, all onap components do the same by setting those limits somewhere in a startup script, in a variable of the container itself or whatever... If you don\u0027t do it the JVM will control it depending of the java version and this will never be unlimited. \nSo unlimited does not mean anything for Java, and it does not mean anything for mostly all Onap java components :-)",
      "parentUuid": "79d89a5c_b54bf81a",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "46e259b3_050c7f54",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 106,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-10-27T21:06:09Z",
      "side": 1,
      "message": "Here’s my proposal: let’s let people the ability to set their own value if they want, and defaulting to « -Xms256m -Xmx1g »",
      "parentUuid": "b26815fa_e5b4c4fe",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e3b26d1a_e2969738",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 106,
      "author": {
        "id": 23
      },
      "writtenOn": "2020-10-28T09:30:02Z",
      "side": 1,
      "message": "Sylvain,\n\nIn fact, I would tend to agree with Krzysztof on that point, if it\u0027s \"unlimited\" we do not set anything and we let the JVM default values.\n\nFrom the web: \"\nFor Java 11 and above\nThe Xmx value is 25% of the available memory with a maximum of 25 GB. However, where there is 2 GB or less of physical memory, the value set is 50% of available memory with a minimum value of 16 MB and a maximum value of 512 MB.\"\n--\u003e So without limitation it could be huge because it takes the memory of your node as a reference.\n\n\nBut i think we should go further than that by removing all the hardcoded/hidden java memory settings everywhere.\nCurrently the \"flavor\" settings is kind of a broken feature in ONAP, because some compos have hidden those parameters somewhere. So changing the flavor does not impact the memory settings at all, which is in my opinion just sad. \nIt\u0027s even worst than that, if you reduce the K8S memory limit under the minimal hardcoded HEAP settings, your pod is never going to start !\nI think if we want to reduce the footprint taken by ONAP this is not going to help :-(\n\nI think we should repair that feature, and make our apps more dynamic. That\u0027s the goal of the new params introduced in Java 11: -XX:MaxRAMPercentage and -XX:MinRAMPercentage\n\n\nSo to recap here (that could be a trial), i would say we remove the memory settings so that \"unlimited\" is JVM controlled.\nAnd we keep the flexibility (-XX:MinRAMPercentage\u003d50 -XX:MaxRAMPercentage\u003d75) when flavor is set so that user can really control the memory in the override file for instance.\n\n\nDoes it sound reasonable ?",
      "parentUuid": "46e259b3_050c7f54",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e5e94291_e7f83645",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 106,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-10-29T08:13:28Z",
      "side": 1,
      "message": "I\u0027ve removed when unlimited and set only when on flavor.",
      "parentUuid": "e3b26d1a_e2969738",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07729e03_85599142",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 108,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-10-27T17:57:52Z",
      "side": 1,
      "message": "Hmm what else is running inside this container? Isn\u0027t it only jvm process? If it\u0027s the only one then why waste 25% of RAM?",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db7557d9_74fb865a",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 108,
      "author": {
        "id": 23
      },
      "writtenOn": "2020-10-27T18:44:27Z",
      "side": 1,
      "message": "Nothing else, only the JVM.\nThese are new parameters introduced since Java 9 (I think :-) ) for JVM running inside a container.\nI do think this should be introduced in all Onap java components.\nDoing so gives us finally a dynamic app that we can control with flavours.\nCurrently flavors are just totally broken because everybody sets the JVM heap params somewhere else.",
      "parentUuid": "07729e03_85599142",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "37e09657_07664c50",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 108,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-10-27T21:06:09Z",
      "side": 1,
      "message": "I believe @Krzysztof question is why max 75% and not 95% or even 100%. \nIs there any reason to keep 25% out of Java?",
      "parentUuid": "db7557d9_74fb865a",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "561a1af6_0a2a6fca",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 108,
      "author": {
        "id": 23
      },
      "writtenOn": "2020-10-28T09:30:02Z",
      "side": 1,
      "message": "It sounds counterintuitive, but both -XX:MaxRAMPercentage and -XX:MinRAMPercentage are used to calculate maximum HEAP size when MaxHeapSize / -Xmx are not set. There are others type of memories managed by the JVM, so set it to 95% is very risky.\nAnd if the limits defined in the flavor are reached, I think k8s is going to kill it.",
      "parentUuid": "37e09657_07664c50",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ff1051d9_528e1bf2",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 108,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-10-29T15:15:08Z",
      "side": 1,
      "message": "Hmmm then why are we defining just a heap size instead of using -Xmx and -Xms and let the JVM determine the proportion between memories that it needs to allocate?",
      "parentUuid": "561a1af6_0a2a6fca",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "337dd15b_f810fcd5",
        "filename": "kubernetes/clamp/components/clamp-backend/templates/deployment.yaml",
        "patchSetId": 7
      },
      "lineNbr": 108,
      "author": {
        "id": 23
      },
      "writtenOn": "2020-11-03T09:54:33Z",
      "side": 1,
      "message": "From different articles I could read and the java -X command:\nXmx and Xms settings are only for heap size not for the others (metaspace,stacks, etc ...)\nIf you set a value for -Xms, the -XX:InitialRAMPercentage option is ignored. If you set a value for -Xmx, the -XX:MaxRAMPercentage option is ignored.\n\nAbout the settings MaxRAMPercentage:\nIt’s true that we can define the -XX:MaxRAMPercentage parameter to 100% but it’s not recommended.\nIt\u0027s required to have some bandwidth for the \"Pod internal resources\" (SSH session, communication with kube api-server)",
      "parentUuid": "ff1051d9_528e1bf2",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0996e7f3_31b42415",
        "filename": "kubernetes/clamp/components/clamp-backend/values.yaml",
        "patchSetId": 7
      },
      "lineNbr": 34,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-10-27T17:57:52Z",
      "side": 1,
      "message": "at this point I\u0027m sure that Sylvain touched this file with his broken editor xD",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2866818_626cc01c",
        "filename": "kubernetes/clamp/components/clamp-backend/values.yaml",
        "patchSetId": 7
      },
      "lineNbr": 34,
      "author": {
        "id": 23
      },
      "writtenOn": "2020-10-27T18:44:27Z",
      "side": 1,
      "message": "LoL",
      "parentUuid": "0996e7f3_31b42415",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fe63134b_93b87d57",
        "filename": "kubernetes/clamp/components/clamp-backend/values.yaml",
        "patchSetId": 7
      },
      "lineNbr": 34,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-10-27T21:08:21Z",
      "side": 1,
      "message": "I keep trying to remove this « feature » but it seems I can’t :’(",
      "parentUuid": "b2866818_626cc01c",
      "revId": "4e86a4b1e339747556573cf38e227dd05d0b072d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    }
  ]
}