{
  "comments": [
    {
      "key": {
        "uuid": "13e45bb2_97458621",
        "filename": "kubernetes/policy/components/policy-api/values.yaml",
        "patchSetId": 29
      },
      "lineNbr": 98,
      "author": {
        "id": 4965
      },
      "writtenOn": "2021-11-08T20:41:12Z",
      "side": 1,
      "message": "this should not be defined here. it should be placed in name: field of secret (above in the secret definition) and here only referenced using a helm hook.\n\nAlso to not break the external secret mechanism you should define externelSecret field as we are doing in other places with \"hasSuffix\" (grep for it and you will find an example",
      "revId": "c52a36c5a4cd9e43d7303c38574a6290a259a9ab",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92edf76c_25cc04a1",
        "filename": "kubernetes/policy/components/policy-api/values.yaml",
        "patchSetId": 29
      },
      "lineNbr": 98,
      "author": {
        "id": 5315
      },
      "writtenOn": "2021-11-09T11:03:26Z",
      "side": 1,
      "message": "Hello Kryzstof,are you aware of the idea? the parent chart create DBs using the common mariadb-galera + mariadb-init, generate credentials to all of them and pass these credentials to sub-components using helm hooks. Sub-charts doesn\u0027t create any DB nor generate credentials.\n\nThis value presented here just to pass linting, it is the default value and should be overwritten by helm hook from the parent chart if needed.\n\n\"hasSuffix\" trick has been used in the parent component (Policy), it won\u0027t add any value here as whatever secret passed by the parent component, should be directly used by the sub-component to access mariadb.\n\nTo have holistic view,\nPolicy (parent component) create DB either local or common, generate passwords, \"hasSuffix\" used to update external secret, pass all needed info to all sub-components using helm hook.\nPolicy-API (sub-component) consumes the provided info to access the pre-created DB.",
      "parentUuid": "13e45bb2_97458621",
      "revId": "c52a36c5a4cd9e43d7303c38574a6290a259a9ab",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ddad348c_99842d47",
        "filename": "kubernetes/policy/components/policy-api/values.yaml",
        "patchSetId": 29
      },
      "lineNbr": 98,
      "author": {
        "id": 4965
      },
      "writtenOn": "2021-11-15T13:42:45Z",
      "side": 1,
      "message": "Ok so I was dumb and didn\u0027t realize that the hasSuffix would be useless here but I\u0027m still curious why you need any value here to pass the linting?\n\nNormally if externalSecret is evaluated to null the chart will try to create a secret using user and password so it should be all fine. So if:\n{{ tpl (default \"\" (index .Values \"mariadb-galera\" \"db\" \"externalSecret\")) . }}\nevaluates to null or empty string we should be all fine with the linting.",
      "parentUuid": "92edf76c_25cc04a1",
      "revId": "c52a36c5a4cd9e43d7303c38574a6290a259a9ab",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e134ea3c_c3754a74",
        "filename": "kubernetes/policy/components/policy-api/values.yaml",
        "patchSetId": 29
      },
      "lineNbr": 98,
      "author": {
        "id": 5315
      },
      "writtenOn": "2021-12-13T13:13:49Z",
      "side": 1,
      "message": "This won\u0027t work as the parent component (policy) already created the same user (user: policy_user) with random password and linked this user to the created list of DBs (migration pooling policyadmin policyclamp operationshistory controlloop), considering policy-api created secret using default usernam and password, still it won\u0027t be able to access the DBs as it is wrong password.\nActually the username and password here are useless (unless in policy the password set to default policy_user without randomizing it).\n\nFor the sub-components (e.g. policy-api) to properly access the DBs, it either needs:\n- The root password of the mariadb-galera, this isn\u0027t desirable due to security.\n- The password of the pre-created user (user: policy_user), which passed from policy using (externalSecret parameter).\n\nWhatever other suggestions I would try and investigate them.",
      "parentUuid": "ddad348c_99842d47",
      "revId": "c52a36c5a4cd9e43d7303c38574a6290a259a9ab",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2aed8db5_f6501bee",
        "filename": "kubernetes/policy/components/policy-api/values.yaml",
        "patchSetId": 29
      },
      "lineNbr": 98,
      "author": {
        "id": 2319
      },
      "writtenOn": "2021-12-14T17:07:48Z",
      "side": 1,
      "message": "I guess that Krzysztof comment was to:\n* put in main policy values the external secret for policy-api and others (like for apiUserExternalSecret) --\u003e As far as I understand your code, that\u0027s what you did\n* put nothing in policy-api values.yaml for secret:\n\n    # Local mariadb galera instance default values\n    mariadb-galera:\n      nameOverride: policy-mariadb\n      db:\n        name: policyadmin\n        user: policy_user\n        password: policy_user\n        # externalSecret:\n    \n\nand it should work ðŸ˜Š",
      "parentUuid": "e134ea3c_c3754a74",
      "revId": "c52a36c5a4cd9e43d7303c38574a6290a259a9ab",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26b4d901_4a40e44f",
        "filename": "kubernetes/policy/components/policy-api/values.yaml",
        "patchSetId": 29
      },
      "lineNbr": 98,
      "author": {
        "id": 5315
      },
      "writtenOn": "2021-12-20T11:46:10Z",
      "side": 1,
      "message": "I have rebased and applied the needed change for testing, once the gating passed I will submit the final version for review",
      "parentUuid": "2aed8db5_f6501bee",
      "revId": "c52a36c5a4cd9e43d7303c38574a6290a259a9ab",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9527ca63_65383cae",
        "filename": "kubernetes/policy/components/policy-clamp-be/values.yaml",
        "patchSetId": 29
      },
      "lineNbr": 101,
      "author": {
        "id": 4965
      },
      "writtenOn": "2021-11-08T20:41:12Z",
      "side": 1,
      "message": "hardocding secret from another component - no way!\nThis needs to be passsed via values from the parent chart don\u0027t hardcore this here",
      "revId": "c52a36c5a4cd9e43d7303c38574a6290a259a9ab",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "51f08c47_8974cc21",
        "filename": "kubernetes/policy/components/policy-clamp-be/values.yaml",
        "patchSetId": 29
      },
      "lineNbr": 101,
      "author": {
        "id": 5315
      },
      "writtenOn": "2021-11-09T11:03:26Z",
      "side": 1,
      "message": "This value presented here just to pass linting, it is the default value and should be overwritten by helm hook from the parent chart if needed.\n\nPlease refer to the previous replay as it sum this change",
      "parentUuid": "9527ca63_65383cae",
      "revId": "c52a36c5a4cd9e43d7303c38574a6290a259a9ab",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    }
  ]
}