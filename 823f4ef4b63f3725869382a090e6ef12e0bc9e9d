{
  "comments": [
    {
      "key": {
        "uuid": "9cdbf691_2c3f9dd9",
        "filename": "kubernetes/dcaegen2-services/common/dcaegen2-services-common/templates/_deployment.tpl",
        "patchSetId": 5
      },
      "lineNbr": 69,
      "author": {
        "id": 4965
      },
      "writtenOn": "2021-04-15T10:34:59Z",
      "side": 1,
      "message": "6 {{ end }} without any indent that\u0027s unreadable. Please indent this correctly as we do in other templates",
      "revId": "823f4ef4b63f3725869382a090e6ef12e0bc9e9d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "edc556d8_ab0adc63",
        "filename": "kubernetes/dcaegen2-services/common/dcaegen2-services-common/templates/_deployment.tpl",
        "patchSetId": 5
      },
      "lineNbr": 69,
      "author": {
        "id": 511
      },
      "writtenOn": "2021-04-15T14:19:39Z",
      "side": 1,
      "message": "What is \"correct indentation\" in Helm?\n\nIf the output were not white-space sensitive, I would have done it like this:\n\n{{- define \"dcaegen2-services-common._ms-specific-env-vars\" -}}\n    {{- $global :\u003d . }}\n    {{- if .Values.applicationEnv }}\n        {{- range $envName, $envValue :\u003d .Values.applicationEnv }}\n            {{- if kindIs \"string\" $envValue }}\n                - name: {{ $envName }}\n                  value: {{ $envValue | quote }}\n            {{- else }}\n                {{- if $envValue.secretUid }}\n                    {{- if $envValue.key }}\n                        - name: {{ $envName }}\n                        {{- include \"common.secret.envFromSecretFast\" (dict \"global\" $global \"uid\" $envValue.secretUid \"key\" $envValue.key) | nindent 2 }}\n                    {{- end }}\n               {{- end }}\n            {{- end -}}\n        {{- end }}\n    {{- end }}\n{{- end -}}\n\nHowever, this makes the output indented differently depending on which condition is met.  Seems like templates should generate text that\u0027s not indented at all.\n\nAlternatively, we could do this:\n\n{{- define \"dcaegen2-services-common._ms-specific-env-vars\" -}}\n    {{- $global :\u003d . }}\n    {{- if .Values.applicationEnv }}\n        {{- range $envName, $envValue :\u003d .Values.applicationEnv }}\n            {{- if kindIs \"string\" $envValue }}\n- name: {{ $envName }}\n  value: {{ $envValue | quote }}\n            {{- else }}\n                {{- if $envValue.secretUid }}\n                    {{- if $envValue.key }}\n- name: {{ $envName }}\n  {{- include \"common.secret.envFromSecretFast\" (dict \"global\" $global \"uid\" $envValue.secretUid \"key\" $envValue.key) | nindent 2 }}\n                    {{- end }}\n               {{- end }}\n            {{- end -}}\n        {{- end }}\n    {{- end }}\n{{- end -}}\n\nTo me, that\u0027s no more readable.  In fact, I find it harder to see what\u0027s going on.  Using 2-space indentation rather than 4 makes it even worse, in my view.\n\nPlease make a clear statement about how you expect Helm to be indented.  I\u0027ve got more changes coming, and other people on the DCAE team are also making changes, so we need to know--not just indentation rules, but any other standards you expect to be met.  It takes days or weeks to cycle through even a small change to OOM, so it\u0027s best if we get it \"right\" at the beginning, rather than going through several cycles to make everything \"correct\".",
      "parentUuid": "9cdbf691_2c3f9dd9",
      "revId": "823f4ef4b63f3725869382a090e6ef12e0bc9e9d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4dead069_27b89d45",
        "filename": "kubernetes/dcaegen2-services/common/dcaegen2-services-common/templates/_deployment.tpl",
        "patchSetId": 5
      },
      "lineNbr": 69,
      "author": {
        "id": 511
      },
      "writtenOn": "2021-04-15T16:23:15Z",
      "side": 1,
      "message": "Perhaps using \"printf\" to generate the text would be acceptable.  It has the downside that the format of the text being emitted isn\u0027t immediately obvious, but it does allow for clean indentation.  In cases where a template has a high ratio of \"{{}}\" to emitted text, this might be a good trade-off.  (In this case, however, there may be some issue with the envFromSecretFast output.)",
      "parentUuid": "edc556d8_ab0adc63",
      "revId": "823f4ef4b63f3725869382a090e6ef12e0bc9e9d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fe93b4fa_1feaeaee",
        "filename": "kubernetes/dcaegen2-services/common/dcaegen2-services-common/templates/_deployment.tpl",
        "patchSetId": 5
      },
      "lineNbr": 69,
      "author": {
        "id": 511
      },
      "writtenOn": "2021-04-15T19:10:13Z",
      "side": 1,
      "message": "Perhaps this?\n\n{{- define \"dcaegen2-services-common._ms-specific-env-vars\" -}}\n  {{- $global :\u003d . }}\n  {{- if .Values.applicationEnv }}\n    {{- range $envName, $envValue :\u003d .Values.applicationEnv }}\n      {{- if kindIs \"string\" $envValue }}\n        {{- printf \"- name: %s\\n  value: %s\\n\" $envName ($envValue | quote) }}\n      {{- else }}\n        {{- if $envValue.secretUid }}\n          {{- if $envValue.key }}\n            {{- $secret :\u003d include \"common.secret.envFromSecretFast\" (dict \"global\" $global \"uid\" $envValue.secretUid \"key\" $envValue.key) | indent 2 -}}\n            {{- printf \"- name: %s\\n%s\\n\" $envName $secret }}\n          {{- end }}\n        {{- end }}\n      {{- end -}}\n    {{- end }}\n  {{- end }}\n{{- end -}}\n\nI prefer 4-space indentation (because 2-space indentation overlaps with the 3-character opening sequence \"{{-\"), but the convention appears to be 2 spaces.",
      "parentUuid": "4dead069_27b89d45",
      "revId": "823f4ef4b63f3725869382a090e6ef12e0bc9e9d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "106d92be_0fe5dafb",
        "filename": "kubernetes/dcaegen2-services/common/dcaegen2-services-common/templates/_deployment.tpl",
        "patchSetId": 5
      },
      "lineNbr": 69,
      "author": {
        "id": 4965
      },
      "writtenOn": "2021-04-16T07:56:42Z",
      "side": 1,
      "message": "Sorry for not being precise enough.\n\nSo usually we are using style where we indent only the \"technical lines\" (those that are starting with {{ and just leave \"rest of the text\" not indented at all (checkout common/common for examples).\nSylvain tends to sometimes use a different style where he indents stuff inside {{ like:\n {{ if a }}\n {{   if b }}\n DoSomeStupidStuff\n {{   end }}\n {{ end }}\n\nso we haven\u0027t yet found a consisting indent style so whatever you decide to do is fine as long as it\u0027s clear and readable:)",
      "parentUuid": "fe93b4fa_1feaeaee",
      "revId": "823f4ef4b63f3725869382a090e6ef12e0bc9e9d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4df213e3_21e7cff1",
        "filename": "kubernetes/dcaegen2-services/common/dcaegen2-services-common/templates/_deployment.tpl",
        "patchSetId": 5
      },
      "lineNbr": 69,
      "author": {
        "id": 511
      },
      "writtenOn": "2021-04-19T21:02:47Z",
      "side": 1,
      "message": "I\u0027ve adopted a 2-space indentation for the \"technical lines\" and leaving the literal text as is.",
      "parentUuid": "106d92be_0fe5dafb",
      "revId": "823f4ef4b63f3725869382a090e6ef12e0bc9e9d",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    }
  ]
}