{
  "comments": [
    {
      "key": {
        "uuid": "39db02bd_ab44c541",
        "filename": "kubernetes/common/mariadb-galera/templates/configmap.yaml",
        "patchSetId": 3
      },
      "lineNbr": 48,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-04-15T22:50:44Z",
      "side": 1,
      "message": "not that I complain once again but I believe that if you put this as a resource in a separate file this whole construct would be more readable;)",
      "range": {
        "startLine": 48,
        "startChar": 1,
        "endLine": 48,
        "endChar": 34
      },
      "revId": "84c32cf42f20fbf0bf70019040362bfab6a7a077",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1977066f_ddbe7dd4",
        "filename": "kubernetes/common/mariadb-galera/templates/configmap.yaml",
        "patchSetId": 3
      },
      "lineNbr": 48,
      "author": {
        "id": 6339
      },
      "writtenOn": "2020-04-16T15:41:30Z",
      "side": 1,
      "message": "I thought I put the content of this mariadb-upgrade-deployment.yaml file in a separate file located in the resource folder from my submitted version. Not sure why it appear like that. @Sylvain, did you modify the submitted code?",
      "parentUuid": "39db02bd_ab44c541",
      "range": {
        "startLine": 48,
        "startChar": 1,
        "endLine": 48,
        "endChar": 34
      },
      "revId": "84c32cf42f20fbf0bf70019040362bfab6a7a077",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bd37bc2e_4893c3ec",
        "filename": "kubernetes/common/mariadb-galera/templates/configmap.yaml",
        "patchSetId": 3
      },
      "lineNbr": 96,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-04-15T22:50:44Z",
      "side": 1,
      "message": "isn\u0027t this whole container description exactly the same as we already have in statefulset.yaml? If yes then maybe a helper template would be useful just to make sure that we have a single source of truth?",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 96,
        "endChar": 46
      },
      "revId": "84c32cf42f20fbf0bf70019040362bfab6a7a077",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9a926c68_0da47237",
        "filename": "kubernetes/common/mariadb-galera/templates/configmap.yaml",
        "patchSetId": 3
      },
      "lineNbr": 96,
      "author": {
        "id": 6339
      },
      "writtenOn": "2020-04-16T15:41:30Z",
      "side": 1,
      "message": "Again I submitted a different version of this file. The submitted content is like this:\n      - name: {{ include \"common.name\" . }}\n        image: \"{{ include \"common.repository\" . }}/{{ .Values.image }}\"\n        ports:\n        - containerPort: {{ .Values.service.internalPort }}\n          name: {{ .Values.service.portName }}\n        - containerPort: {{ .Values.service.sstPort }}\n          name: {{ .Values.service.sstPortName }}\n        - containerPort: {{ .Values.service.replicationPort }}\n          name: {{ .Values.service.replicationName }}\n        - containerPort: {{ .Values.service.istPort }}\n          name: {{ .Values.service.istPortName }}\n        env:\n        - name: POD_NAMESPACE\n          valueFrom:\n                fieldRef:\n                  apiVersion: v1\n                  fieldPath: metadata.namespace\n        - name: MYSQL_USER\n          value: {{ default \"\" .Values.config.userName | quote }}\n        - name: MYSQL_PASSWORD\n          valueFrom:\n                secretKeyRef:\n                  name: {{ template \"common.fullname\" . }}\n                  key: user-password\n        - name: MYSQL_DATABASE\n          value: {{ default \"\" .Values.config.mysqlDatabase | quote }}\n        - name: MYSQL_ROOT_PASSWORD\n          valueFrom:\n                secretKeyRef:\n                  name: {{ template \"common.fullname\" . }}\n                  key: db-root-password\n      subdomain: {{ .Values.service.name }}\n      hostname: {{ .Values.nameOverride }}-upgrade-deployment\n\n* You can notice that the content from MYSQL_USER to MYSQL_ROOT_PASSWORD is not similar to the statefulset.yaml in the master branch, but is similar to the statefulset.yaml in the El Alto branch. As I have explained to Sylvain from previous message (https://gerrit.onap.org/r/c/oom/+/104905). The reason is that using the value of environment with \"envFromSecretFast\" (from the master branch) is not applicable because they rely on mariadb-galera-db-user-credentials configmaps to exists. However, mariadb-galera-db-user-credentials only appears in the post-upgrade, and this mariadb-upgrade-deployment.yaml is created in a pre-upgrade process, where mariadb-galera-db-user-credentials is not created yet. In this case, I must use the same value as used in El Alto release in order to retrieve available secrets and configmaps existing before the helm upgrade, as following:\n- name: MYSQL_USER\n          value: {{ default \"\" .Values.config.userName | quote }}\n        - name: MYSQL_PASSWORD\n          valueFrom:\n                secretKeyRef:\n                  name: {{ template \"common.fullname\" . }}\n                  key: user-password\n        - name: MYSQL_ROOT_PASSWORD\n          valueFrom:\n                secretKeyRef:\n                  name: {{ template \"common.fullname\" . }}\n                  key: db-root-password",
      "parentUuid": "bd37bc2e_4893c3ec",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 96,
        "endChar": 46
      },
      "revId": "84c32cf42f20fbf0bf70019040362bfab6a7a077",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "59e3fdeb_bbf63a11",
        "filename": "kubernetes/common/mariadb-galera/templates/job.yaml",
        "patchSetId": 3
      },
      "lineNbr": 44,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-04-15T22:51:56Z",
      "side": 1,
      "message": "how about extracting this to a shell script that you will just provide as a resource? DOn\u0027t you think that it would be a little bit more readable this way?;)",
      "range": {
        "startLine": 34,
        "startChar": 9,
        "endLine": 44,
        "endChar": 15
      },
      "revId": "84c32cf42f20fbf0bf70019040362bfab6a7a077",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a0c79b1e_312ab8e1",
        "filename": "kubernetes/common/mariadb-galera/templates/job.yaml",
        "patchSetId": 3
      },
      "lineNbr": 44,
      "author": {
        "id": 6339
      },
      "writtenOn": "2020-04-16T15:50:25Z",
      "side": 1,
      "message": "I will modify that.",
      "parentUuid": "59e3fdeb_bbf63a11",
      "range": {
        "startLine": 34,
        "startChar": 9,
        "endLine": 44,
        "endChar": 15
      },
      "revId": "84c32cf42f20fbf0bf70019040362bfab6a7a077",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    }
  ]
}