apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: sparky-be
  namespace: "{{ .Values.nsPrefix }}-aai"
spec:
  selector:
    matchLabels:
      app: sparky-be
  template:
    metadata:
      labels:
        app: sparky-be
      name: sparky-be
    spec:
      containers:
      - name: sparky-be
        image: "{{ .Values.image.sparkyBeImage }}:{{ .Values.image.sparkyBeVersion }}"
        imagePullPolicy: {{ .Values.pullPolicy }}
        env:
        - name: CONFIG_HOME
          value: /opt/app/sparky/config/
        - name: KEY_MANAGER_PASSWORD
          value: OBF:1i9a1u2a1unz1lr61wn51wn11lss1unz1u301i6o
        - name: KEY_STORE_PASSWORD
          value: OBF:1i9a1u2a1unz1lr61wn51wn11lss1unz1u301i6o
        volumeMounts:
        - mountPath: /etc/localtime
          name: localtime
          readOnly: true
        - mountPath: /opt/app/sparky/config/
          name: aai-sparky-be-config
        - mountPath: /opt/app/sparky/config/auth/client-cert-onap.p12 
          name: aai-sparky-be-client-cert
        - mountPath: /opt/app/sparky/config/auth/aai-os-cert.p12
          name: aai-sparky-be-aai-os-cert
        - mountPath: /opt/app/sparky/config/auth/inventory-ui-keystore
          name: aai-sparky-be-inventory-key
        - mountPath: /logs/
          name: aai-sparky-be-logs
        ports:
        - containerPort: 9517
        readinessProbe:
          tcpSocket:
            port: 9517
          initialDelaySeconds: 5
          periodSeconds: 10
      volumes:
      - name: localtime
        hostPath:
          path: /etc/localtime
      - name: aai-sparky-be-config
        hostPath:
          path: "/dockerdata-nfs/{{ .Values.nsPrefix }}/aai/sparky-be/appconfig/"
      - name: aai-sparky-be-logs
        hostPath:
          path: "/dockerdata-nfs/{{ .Values.nsPrefix }}/aai/sparky-be/logs/"
      - name: aai-sparky-be-client-cert
        secret:
          secretName: secret-{{ .Values.nsPrefix }}-aai
      - name: aai-sparky-be-aai-os-cert
        secret:
          secretName: secret-{{ .Values.nsPrefix }}-aai
      - name: aai-sparky-be-inventory-key
        secret:
          secretName: secret-{{ .Values.nsPrefix }}-aai
      restartPolicy: Always
      imagePullSecrets:
      - name: "{{ .Values.nsPrefix }}-docker-registry-key"
