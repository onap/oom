{
  "comments": [
    {
      "key": {
        "uuid": "64e5b9c0_330eff4b",
        "filename": "kubernetes/portal/charts/portal-sdk/resources/config/deliveries/properties/ONAPPORTALSDK/system.properties",
        "patchSetId": 2
      },
      "lineNbr": 88,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-02-21T08:20:36Z",
      "side": 1,
      "message": "Can you set a secret and retrieve it at launch (see https://gerrit.onap.org/r/c/oom/+/102103 for an example)?",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b9edba1d_33319938",
        "filename": "kubernetes/portal/charts/portal-sdk/resources/config/deliveries/properties/ONAPPORTALSDK/system.properties",
        "patchSetId": 2
      },
      "lineNbr": 88,
      "author": {
        "id": 5
      },
      "writtenOn": "2020-02-21T14:02:44Z",
      "side": 1,
      "message": "Sure we can do that, note that these are placeholders and replaced at runtime, so it\u0027s not that critical",
      "parentUuid": "64e5b9c0_330eff4b",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8936426f_72ae74cb",
        "filename": "kubernetes/portal/charts/portal-sdk/resources/config/deliveries/properties/ONAPPORTALSDK/system.properties",
        "patchSetId": 2
      },
      "lineNbr": 88,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-02-21T15:19:42Z",
      "side": 1,
      "message": "if this is replaced in runtime then please put here anything that doesn\u0027t look like password like \u003cthis will be replaced in runtime\u003e",
      "parentUuid": "b9edba1d_33319938",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16485ad6_0c385be4",
        "filename": "kubernetes/portal/charts/portal-sdk/resources/server/server.xml",
        "patchSetId": 2
      },
      "lineNbr": 98,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-02-21T08:20:36Z",
      "side": 1,
      "message": "same here",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fe4d9487_b3635968",
        "filename": "kubernetes/portal/charts/portal-sdk/resources/server/server.xml",
        "patchSetId": 2
      },
      "lineNbr": 98,
      "author": {
        "id": 5
      },
      "writtenOn": "2020-02-21T14:02:44Z",
      "side": 1,
      "message": "I don\u0027t see an obvious way to replace this with a secret.\nthis is the generated keystore password retrieved by AAF init container, so it is not known until the init container completes (and changes at each run), i used a trick to pass this through local env variables (and avoid this being written in clear), unless you have a way to dynamically create a secret from the completion of an init container that I don\u0027t know (maybe avail in later helm release?).",
      "parentUuid": "16485ad6_0c385be4",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb5e4ccc_2f4def59",
        "filename": "kubernetes/portal/charts/portal-sdk/resources/server/server.xml",
        "patchSetId": 2
      },
      "lineNbr": 98,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-02-21T14:35:24Z",
      "side": 1,
      "message": "${javax.net.ssl.keyStorePassword} is  an env variable? OOPs, I\u0027ve read too fast and thought it was a template variable ^_^--\u003e good for me!",
      "parentUuid": "fe4d9487_b3635968",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "672adf20_4553f2eb",
        "filename": "kubernetes/portal/charts/portal-sdk/resources/server/server.xml",
        "patchSetId": 2
      },
      "lineNbr": 98,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-02-21T15:19:42Z",
      "side": 1,
      "message": "Nope it\u0027s not good.\n\nThis env variable is set to some value at the deployment time without using a secret;)",
      "parentUuid": "eb5e4ccc_2f4def59",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "53b2bc37_883ac313",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 114,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-02-21T11:04:18Z",
      "side": 1,
      "message": "this should be a secret",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3e7ca172_a04c4557",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 114,
      "author": {
        "id": 5
      },
      "writtenOn": "2020-02-21T14:02:44Z",
      "side": 1,
      "message": "I don\u0027t see an obvious way to replace this with a secret.\nthis is the generated keystore password retrieved by AAF init container, so it is not known until the init container completes (and changes at each run), i used a trick to pass this through local env variables (and avoid this being written in clear), unless you have a way to dynamically create a secret from the completion of an init container that I don\u0027t know (maybe avail in later helm release?).",
      "parentUuid": "53b2bc37_883ac313",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e39f839e_d3aa40d4",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 114,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-02-21T14:35:24Z",
      "side": 1,
      "message": "I think that @Krzyzstof did the same error than me and thought it\u0027s a template value",
      "parentUuid": "3e7ca172_a04c4557",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6ac59c59_70c72c88",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 114,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-02-21T15:19:42Z",
      "side": 1,
      "message": "Oh now I get it;) It\u0027s an environment variable that contains the reference to other environment variable\n\nUnfortunately you trick is kind of bad from a security stand point of view. As far as I can see in the tomcat code:\nhttps://github.com/apache/tomcat/blob/1d97bbbd4f060c7c9ab39f12bc67fde3085f36ef/bin/daemon.sh\nThose options are just concatenated to the cmdline. The problem with that is that by default /proc/\u003cpid\u003e/cmdline is world readable which leaks the password to all other processes while /proc/\u003cpid\u003e/environ is readable only for owner of the process (or someone with PTRACE caps)",
      "parentUuid": "e39f839e_d3aa40d4",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44c47e7a_1da4bac8",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 116,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-02-21T11:04:18Z",
      "side": 1,
      "message": "this one also",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fbee5d0c_744d8ca2",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 116,
      "author": {
        "id": 5
      },
      "writtenOn": "2020-02-21T14:02:44Z",
      "side": 1,
      "message": "same as above",
      "parentUuid": "44c47e7a_1da4bac8",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2cdb9d39_dd7327ca",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 119,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-02-21T11:04:18Z",
      "side": 1,
      "message": "this should be a secret",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6f28692f_abcc514c",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 119,
      "author": {
        "id": 5
      },
      "writtenOn": "2020-02-21T14:02:44Z",
      "side": 1,
      "message": "same as above",
      "parentUuid": "2cdb9d39_dd7327ca",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fb306e0e_6e5fbabb",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 123,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-02-21T11:04:18Z",
      "side": 1,
      "message": "this should be a secret",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6f5be090_b5b1bc24",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/deployment.yaml",
        "patchSetId": 2
      },
      "lineNbr": 123,
      "author": {
        "id": 5
      },
      "writtenOn": "2020-02-21T14:02:44Z",
      "side": 1,
      "message": "same as above",
      "parentUuid": "fb306e0e_6e5fbabb",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ae7a62f_f3f98840",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/portal-sdk-aaf-pv.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-02-21T08:20:36Z",
      "side": 1,
      "message": "Do we really need to save it on a PV or can we just save it on a memory volume mount? (see https://gerrit.onap.org/r/c/oom/+/102079)",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3ab3996a_2b33e302",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/portal-sdk-aaf-pv.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-02-21T11:04:18Z",
      "side": 1,
      "message": "That\u0027s a very good question. Personally I\u0027ve been thinking about this for some time but as AAF is effectively an orphan currently I don\u0027t have any one to talk about this:(\n\nThe difference between saving it to memory and using PV is that in case of PV I expect that this certificate is generated only once per deployment (and then refreshed when needed). In case of in-memory volume this would need to happen on every node separately so it AAF may become a bottle neck during startup time",
      "parentUuid": "6ae7a62f_f3f98840",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "939736d6_521dea42",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/portal-sdk-aaf-pv.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 5
      },
      "writtenOn": "2020-02-21T14:02:44Z",
      "side": 1,
      "message": "Personally, i like the idea of having this in memory as well (feels safer), now I see the point for slowing down startup (which is already not fast), maybe it\u0027s a broader question though and certainly for the AAF team to be involved. Let me align this with Sylvain\u0027s work in the above PR.",
      "parentUuid": "3ab3996a_2b33e302",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "03c91c82_b017dbd6",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/portal-sdk-aaf-pv.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-02-21T14:35:24Z",
      "side": 1,
      "message": "@Krzysztof, it\u0027s not the case actually as first thing done by script is to erase everything:\n\n...\n/opt/app/osaaf/local exists\nExisting files in /opt/app/osaaf/local\ntotal 0\nClean up directory /opt/app/osaaf/local\nNamespace is org.onap.dmaap-dr\n...\n(from Fiachra email on issue between AAF and DMaaP DR...)\n\nSo in memory or not would be the same no (in term of speed)?\nAnd having one PVC (and maybe PV) less will make first start faster",
      "parentUuid": "939736d6_521dea42",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b5efa1b5_81a9e03b",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/portal-sdk-aaf-pv.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 4965
      },
      "writtenOn": "2020-02-21T15:19:42Z",
      "side": 1,
      "message": "really? Isn\u0027t it the a one big race condition?\n\nConsider the scenario where we have 2 PODs starting on 2 different nodes:\nPod1               Pod2\nremove old config\ninit_aaf\nsave cert to pv\n                    remove old config\nTry to use cert\nbut it doesn\u0027t exist\n                     init aaf\nfail\n                     save cert to PV\n                     Use the cert",
      "parentUuid": "03c91c82_b017dbd6",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a1564c71_9f83ee30",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/portal-sdk-aaf-pv.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-02-21T16:46:35Z",
      "side": 1,
      "message": "well it seems to be the way it\u0027s done today. \nBut your proposition would not work as POD2 couldn\u0027t start (PV is RWO)\n\nif it\u0027s in memory we wouldn\u0027t have this issue ;)",
      "parentUuid": "b5efa1b5_81a9e03b",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "08dfb38c_f614d615",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/portal-sdk-aaf-pvc.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-02-21T08:20:36Z",
      "side": 1,
      "message": "same as previous",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aa07ac1e_e1c1e531",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/portal-sdk-aaf-pvc.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 5
      },
      "writtenOn": "2020-02-21T14:02:44Z",
      "side": 1,
      "message": "see previous answer :-) I\u0027ll align with your impl",
      "parentUuid": "08dfb38c_f614d615",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "47751953_f6360f8e",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/secrets.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 2319
      },
      "writtenOn": "2020-02-21T08:20:36Z",
      "side": 1,
      "message": "@Krzysztof has created a template for secrets that simplify the process: https://gerrit.onap.org/r/c/oom/+/102079/3/kubernetes/nbi/values.yaml#46",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a6aed531_fad9c1b9",
        "filename": "kubernetes/portal/charts/portal-sdk/templates/secrets.yaml",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 5
      },
      "writtenOn": "2020-02-21T14:02:44Z",
      "side": 1,
      "message": "Thanks for the pointer, I\u0027ll align with this",
      "parentUuid": "47751953_f6360f8e",
      "revId": "522e777bd8d0119737c22148328a89dd6ee15a22",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    }
  ]
}