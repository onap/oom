[tox]
minversion = 1.6
envlist =
 pylint,
 gitlint,
 find-tabs,
 find-trailing-whitespaces,
 doc8,
 docs-linkcheck,
 spelling,
 checkbashisms,
 docs,
skipsdist=true

[doc8]
ignore-path-errors=docs/helm-search.txt;D001

[testenv:doc8]
deps =
    -r{toxinidir}/requirements.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.os.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.onap.txt
commands =
 - doc8 docs/

[testenv:docs]
deps =
    -r{toxinidir}/requirements.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.os.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.onap.txt
commands =
 sphinx-build -q -W -b html -n -d {envtmpdir}/doctrees ./docs/ {toxinidir}/docs/_build/html

[testenv:docs-linkcheck]
deps =
    -r{toxinidir}/requirements.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.os.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.onap.txt
commands = sphinx-build -q -W -b linkcheck -d {envtmpdir}/doctrees ./docs/ {toxinidir}/docs/_build/linkcheck

[testenv:spelling]
#basepython = python3
whitelist_externals = wget
deps =
    -r{toxinidir}/requirements.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.os.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.onap.txt
changedir={toxinidir}/docs
commands =
    wget -nv https://git.onap.org/doc/plain/docs/spelling_wordlist.txt -O spelling_wordlist.txt
    sphinx-build -W -b spelling -d {envtmpdir}/doctrees . _build/spelling

[testenv:gitlint]
basepython = python3
deps =
    -r{toxinidir}/requirements.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.os.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.onap.txt
commands =
  gitlint

[testenv:checkbashisms]
deps =
whitelist_externals =
    {toxinidir}/.ci/check-bashisms.sh
commands =
    {toxinidir}/.ci/check-bashisms.sh

[testenv:shellcheck]
basepython = python3
deps = shellcheck-py
whitelist_externals = find
commands =
    find . -not -path '*/\.*' -name *.sh -exec shellcheck \{\} +

[testenv:autopep8]
deps =
    -r{toxinidir}/requirements.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.os.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.onap.txt
commands =
    autopep8 --max-line-length 120 --in-place --recursive kubernetes/ TOSCA/ docs/

[testenv:pylint]
deps =
    -r{toxinidir}/requirements.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.os.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.onap.txt
whitelist_externals = find
commands =
    find kubernetes/ TOSCA/ docs/ -name *.py -exec pylint --rcfile=.pylintrc -E \{\} +

[testenv:pylint_full]
deps =
    -r{toxinidir}/requirements.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.os.txt
    -chttps://git.onap.org/doc/plain/etc/upper-constraints.onap.txt
whitelist_externals = find
commands =
    find kubernetes/ TOSCA/ docs/ -name *.py -exec pylint --rcfile=.pylintrc --reports=yes \{\} +

[testenv:find-tabs]
deps =
whitelist_externals =
    {toxinidir}/.ci/find-tabs.sh
commands =
    {toxinidir}/.ci/find-tabs.sh

[testenv:find-trailing-whitespaces]
deps =
whitelist_externals =
    {toxinidir}/.ci/find-trailing-whitespaces.sh
commands =
    {toxinidir}/.ci/find-trailing-whitespaces.sh
