{
  "comments": [
    {
      "key": {
        "uuid": "5a93c517_4386ec14",
        "filename": "kubernetes/cli/templates/all-service.yaml",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 497
      },
      "writtenOn": "2018-01-18T14:55:40Z",
      "side": 1,
      "message": "Could you please explain why the port and the targetPort are different? Per k8s documentation (https://kubernetes.io/docs/concepts/services-networking/service/), \"By default the targetPort will be set to the same value as the port field.\"\nIs this differentiation really necessary?",
      "range": {
        "startLine": 12,
        "startChar": 10,
        "endLine": 12,
        "endChar": 14
      },
      "revId": "745a5751080706cbc89c36826a627fd30c5eaa8e",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5a93c517_23a08042",
        "filename": "kubernetes/cli/templates/all-service.yaml",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1699
      },
      "writtenOn": "2018-01-18T18:32:33Z",
      "side": 1,
      "message": "The code shows that \n* CLI pod exposes port 80 and 8080.\n* the CLI service is mapping port 80 to 8080, and port 8080 to 9090.\n\nWould be good to have a bit explanation about this in the description. ~.~",
      "parentUuid": "5a93c517_4386ec14",
      "range": {
        "startLine": 12,
        "startChar": 10,
        "endLine": 12,
        "endChar": 14
      },
      "revId": "745a5751080706cbc89c36826a627fd30c5eaa8e",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5a93c517_6690d643",
        "filename": "kubernetes/cli/templates/all-service.yaml",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 2939
      },
      "writtenOn": "2018-01-19T02:37:48Z",
      "side": 1,
      "message": "Because https://git.onap.org/cli/tree/deployment/docker/src/main/docker/docker-compose.yaml describes the necessary port mapping:\n\nservices:\n  occ:\n    image: onap/cli\n    environment:\n      OPEN_CLI_MODE: \u0027daemon\u0027\n    ports:\n      - 8080:80\n      - 9090:8080\n\nIf you ssh in CLI container, you can find there are 2 exposed port, 80 for lighttpd, 8080 for gotty to provide CLI on webpage. If you login in vnc-portal, you click the CLI icon, it tries to access port 8080, so 8080 port should be mapped to container port 80. You can also check the https://git.onap.org/cli/tree/deployment/http/web/index.html. If you click link to open CLI in webpage, it will access port 9090, so port 9090 should be mapped to container 8080. I have implemented this solution, currently we can use 8080 to access web page and 9090 to access CLI.\n\nonap@onap-ProLiant-DL360-Gen9:~/setup/oom-amsterdam/kubernetes/cli/templates$ kubectl exec -it cli-1971128182-p1mwg bash -n onap-cli\n\nroot@cli-1971128182-p1mwg:/opt/onap/cli# netstat -nltp\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -                   \ntcp6       0      0 :::8080                 :::*                    LISTEN      16/gotty\n\n\nhttps://git.onap.org/cli/tree/deployment/http/web/index.html:\nfunction redirectToConsole(){\n   window.location.href\u003d\"http://\"+  window.location.hostname + \":9090\";\n}\n\n\u003cp style\u003d\"color:blue\"\u003eClick \u003ca onclick\u003d\"redirectToConsole();\"\u003ehere\u003c/a\u003e\u003c/p\u003e",
      "parentUuid": "5a93c517_4386ec14",
      "range": {
        "startLine": 12,
        "startChar": 10,
        "endLine": 12,
        "endChar": 14
      },
      "revId": "745a5751080706cbc89c36826a627fd30c5eaa8e",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5a93c517_8693a24e",
        "filename": "kubernetes/cli/templates/all-service.yaml",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 2939
      },
      "writtenOn": "2018-01-19T02:37:48Z",
      "side": 1,
      "message": "Because https://git.onap.org/cli/tree/deployment/docker/src/main/docker/docker-compose.yaml describes the necessary port mapping:\n\nservices:\n  occ:\n    image: onap/cli\n    environment:\n      OPEN_CLI_MODE: \u0027daemon\u0027\n    ports:\n      - 8080:80\n      - 9090:8080\n\nIf you ssh in CLI container, you can find there are 2 exposed port, 80 for lighttpd, 8080 for gotty to provide CLI on webpage. If you login in vnc-portal, you click the CLI icon, it tries to access port 8080, so 8080 port should be mapped to container port 80. You can also check the https://git.onap.org/cli/tree/deployment/http/web/index.html. If you click link to open CLI in webpage, it will access port 9090, so port 9090 should be mapped to container 8080. I have implemented this solution, currently we can use 8080 to access web page and 9090 to access CLI.\n\nonap@onap-ProLiant-DL360-Gen9:~/setup/oom-amsterdam/kubernetes/cli/templates$ kubectl exec -it cli-1971128182-p1mwg bash -n onap-cli\n\nroot@cli-1971128182-p1mwg:/opt/onap/cli# netstat -nltp\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -                   \ntcp6       0      0 :::8080                 :::*                    LISTEN      16/gotty\n\n\nhttps://git.onap.org/cli/tree/deployment/http/web/index.html:\nfunction redirectToConsole(){\n   window.location.href\u003d\"http://\"+  window.location.hostname + \":9090\";\n}\n\n\u003cp style\u003d\"color:blue\"\u003eClick \u003ca onclick\u003d\"redirectToConsole();\"\u003ehere\u003c/a\u003e\u003c/p\u003e",
      "parentUuid": "5a93c517_23a08042",
      "range": {
        "startLine": 12,
        "startChar": 10,
        "endLine": 12,
        "endChar": 14
      },
      "revId": "745a5751080706cbc89c36826a627fd30c5eaa8e",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5a93c517_060f922f",
        "filename": "kubernetes/cli/templates/cli-deployment.yaml",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 2541
      },
      "writtenOn": "2018-01-18T20:08:44Z",
      "side": 1,
      "message": "port 8080 is used for? should it show up in readinessProbe too?",
      "range": {
        "startLine": 28,
        "startChar": 25,
        "endLine": 28,
        "endChar": 29
      },
      "revId": "745a5751080706cbc89c36826a627fd30c5eaa8e",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    }
  ]
}